<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<LoganContent xmlns="http://www.oracle.com/DataCenter/LogAnalyticsStd" content_version="2.94.1.0.0" name="content_ocid1.tenancy.oc1..aaaaaaaa5s2vdjjrydixjulorcwozffbpna37w5a35p3jhgpyshlkmio6oiq_1725558434942" oms_version="2.94.1.0.0">
   <Field oms_version="2.94.1.0.0">
      <DisplayName>GPU Xid Error Code</DisplayName>
      <Description>GPU Xid Error Code</Description>
      <FieldType>1</FieldType>
      <IsSystem>0</IsSystem>
      <IsPrimary>1</IsPrimary>
      <DataType>INTEGER</DataType>
      <IsMetricKeyEligible>0</IsMetricKeyEligible>
      <IsMetricValueEligible>0</IsMetricValueEligible>
      <FacetEligible>1</FacetEligible>
      <RangeFacetEligible>0</RangeFacetEligible>
      <TableEligible>1</TableEligible>
      <FacetPriority>1</FacetPriority>
      <Summarizable>1</Summarizable>
      <HighCardinality>1</HighCardinality>
      <LargeData>0</LargeData>
      <MultiValued>0</MultiValued>
      <SMAEnabledSetting>0</SMAEnabledSetting>
   </Field>
   <Field oms_version="2.94.1.0.0">
      <DisplayName>GPU Model</DisplayName>
      <FieldType>1</FieldType>
      <IsSystem>0</IsSystem>
      <IsPrimary>1</IsPrimary>
      <DataType>STRING</DataType>
      <IsMetricKeyEligible>0</IsMetricKeyEligible>
      <IsMetricValueEligible>0</IsMetricValueEligible>
      <FacetEligible>1</FacetEligible>
      <RangeFacetEligible>0</RangeFacetEligible>
      <TableEligible>1</TableEligible>
      <FacetPriority>1</FacetPriority>
      <Summarizable>1</Summarizable>
      <HighCardinality>1</HighCardinality>
      <LargeData>0</LargeData>
      <MultiValued>0</MultiValued>
      <SMAEnabledSetting>0</SMAEnabledSetting>
   </Field>
   <Field oms_version="2.94.1.0.0">
      <DisplayName>BandWidth DtoH</DisplayName>
      <Description>Device To Host bandwidth</Description>
      <FieldType>1</FieldType>
      <IsSystem>0</IsSystem>
      <IsPrimary>1</IsPrimary>
      <DataType>FLOAT</DataType>
      <IsMetricKeyEligible>0</IsMetricKeyEligible>
      <IsMetricValueEligible>0</IsMetricValueEligible>
      <FacetEligible>1</FacetEligible>
      <RangeFacetEligible>0</RangeFacetEligible>
      <TableEligible>1</TableEligible>
      <FacetPriority>1</FacetPriority>
      <Summarizable>1</Summarizable>
      <HighCardinality>1</HighCardinality>
      <LargeData>0</LargeData>
      <MultiValued>0</MultiValued>
      <SMAEnabledSetting>0</SMAEnabledSetting>
   </Field>
   <Field oms_version="2.94.1.0.0">
      <DisplayName>BandWidth HtoD</DisplayName>
      <Description>Host To Device BandWidth</Description>
      <FieldType>1</FieldType>
      <IsSystem>0</IsSystem>
      <IsPrimary>1</IsPrimary>
      <DataType>FLOAT</DataType>
      <IsMetricKeyEligible>0</IsMetricKeyEligible>
      <IsMetricValueEligible>0</IsMetricValueEligible>
      <FacetEligible>1</FacetEligible>
      <RangeFacetEligible>0</RangeFacetEligible>
      <TableEligible>1</TableEligible>
      <FacetPriority>1</FacetPriority>
      <Summarizable>1</Summarizable>
      <HighCardinality>1</HighCardinality>
      <LargeData>0</LargeData>
      <MultiValued>0</MultiValued>
      <SMAEnabledSetting>0</SMAEnabledSetting>
   </Field>
   <Field oms_version="2.94.1.0.0">
      <DisplayName>GPU Count</DisplayName>
      <FieldType>1</FieldType>
      <IsSystem>0</IsSystem>
      <IsPrimary>1</IsPrimary>
      <DataType>INTEGER</DataType>
      <IsMetricKeyEligible>0</IsMetricKeyEligible>
      <IsMetricValueEligible>0</IsMetricValueEligible>
      <FacetEligible>1</FacetEligible>
      <RangeFacetEligible>0</RangeFacetEligible>
      <TableEligible>1</TableEligible>
      <FacetPriority>1</FacetPriority>
      <Summarizable>1</Summarizable>
      <HighCardinality>1</HighCardinality>
      <LargeData>0</LargeData>
      <MultiValued>0</MultiValued>
      <SMAEnabledSetting>0</SMAEnabledSetting>
   </Field>
   <Tag>
      <Name>#check_failed</Name>
      <DisplayName>Check Failed</DisplayName>
      <IsSystem>0</IsSystem>
      <ProblemPriority>HIGH</ProblemPriority>
   </Tag>
   <Parser oms_version="2.94.1.0.0" tokenize_orig_text="1" type="0">
      <Name>Test GPU Checks</Name>
      <DisplayName>Test GPU Checks</DisplayName>
      <ParserContent>{TIMEDATE}\s+-\s+(.*?)\s+-\s+(.*)</ParserContent>
      <IsSingleLineContent>1</IsSingleLineContent>
      <ExampleContent>2024-06-12 23:29:19,528 - INFO - GPU Remap Test: Passed
2024-06-12 23:33:04,560 - ERROR - RTTCC issues: ['RTTCC enabled on: mlx5_0', 'RTTCC enabled on: mlx5_1', 'RTTCC enabled on: mlx5_3', 'RTTCC enabled on: mlx5_4', 'RTTCC enabled on: mlx5_5', 'RTTCC enabled on: mlx5_6', 'RTTCC enabled on: mlx5_7', 'RTTCC enabled on: mlx5_8', 'RTTCC enabled on: mlx5_9', 'RTTCC enabled on: mlx5_10', 'RTTCC enabled on: mlx5_12', 'RTTCC enabled on: mlx5_13', 'RTTCC enabled on: mlx5_14', 'RTTCC enabled on: mlx5_15', 'RTTCC enabled on: mlx5_16', 'RTTCC enabled on: mlx5_17']
2024-06-13 01:47:23,306 - ERROR - 2348XLG043 - GPU bandwidth issues: Device: 0 DtoH: -1.0 is below threshold: 52.0
2024-06-13 04:34:57,362 - ERROR - GPU processes are running on the host. Please make sure no processes are running on the GPU before you re-test
2024-06-13 01:36:15,136 - DEBUG - Checking for GPU Xid 50 error in dmesg
2024-06-12 23:30:26,138 - DEBUG - mlx5_10: Cable is unplugged
</ExampleContent>
      <IsSystem>0</IsSystem>
      <Encoding>UTF-8</Encoding>
      <Language>en_US</Language>
      <ParserFields>
         <ParserField>
            <FieldSeq>2</FieldSeq>
            <FieldName>msg</FieldName>
         </ParserField>
         <ParserField>
            <FieldSeq>1</FieldSeq>
            <FieldName>sevlvl</FieldName>
         </ParserField>
      </ParserFields>
      <WrittenOnce>0</WrittenOnce>
      <IsDefaultParser>1</IsDefaultParser>
   </Parser>
   <Source configWarningSettings="0" name="GPU RDMA Link Flapping Check" oms_version="2.94.1.0.0">
      <SourceType>os_file</SourceType>
      <TargetTypes>
         <TargetType>omc_host_linux</TargetType>
      </TargetTypes>
      <DisplayName>GPU RDMA Link Flapping Check</DisplayName>
      <Description>GPU RDMA Link Flapping Check</Description>
      <IsSystem>0</IsSystem>
      <IsSecureContent>1</IsSecureContent>
      <Patterns>
         <Pattern>
            <Value>/opt/oracle/logs/scan_logs/nhcrdmaflapping_*.log</Value>
            <IsInclude>1</IsInclude>
            <InUse>1</InUse>
            <IsSystem>0</IsSystem>
            <IsEnabled>1</IsEnabled>
         </Pattern>
      </Patterns>
      <Parsers>
         <Parser>
            <ParserSeq>1</ParserSeq>
            <ParserName>Test GPU Checks</ParserName>
         </Parser>
      </Parsers>
      <ExtFieldDefinitions>
         <ExtFieldDefinition>
            <BaseFieldName>mtgt</BaseFieldName>
            <BaseFieldLogText>octane-ord-non-restricted-bm-gpu-h100-8-ad1-008.compute.nrphxvcnc.oraclevcn.com</BaseFieldLogText>
            <RegexExpression>octane-ord-non-restricted-bm-gpu-h100-8-{nodedisplayname:\S+}.compute.nrphxvcnc.oraclevcn.com</RegexExpression>
            <ExtFieldName>nodedisplayname</ExtFieldName>
            <IsSystem>0</IsSystem>
            <IsEnabled>1</IsEnabled>
         </ExtFieldDefinition>
         <ExtFieldDefinition>
            <BaseFieldName>mlogent</BaseFieldName>
            <BaseFieldLogText>/mnt/shared/hc/health_checks/cloud_scripts/oci/h100_health_checks/nhc_2349xlg00g_octane-ord-non-restricted-bm-gpu-h100-8-ad1-030_20240613-144501.log	46</BaseFieldLogText>
            <RegexExpression>nhc_{hwid:[^\_]+}_octane-ord-non-restricted-bm-gpu-{udfs1:.*}-{udfi2:\d+}-{availdomain:.*}-{instid:\d+}_2024.*.log</RegexExpression>
            <ExtFieldName>availdomain</ExtFieldName>
            <ExtFieldName>hwid</ExtFieldName>
            <ExtFieldName>instid</ExtFieldName>
            <ExtFieldName>udfi2</ExtFieldName>
            <ExtFieldName>udfs1</ExtFieldName>
            <IsSystem>0</IsSystem>
            <IsEnabled>1</IsEnabled>
         </ExtFieldDefinition>
      </ExtFieldDefinitions>
      <ExtFieldDefinitions>
         <Condition field="sevlvl" operator="EQUAL">
            <ConditionValues>
               <ConditionValue>ERROR</ConditionValue>
            </ConditionValues>
         </Condition>
         <ExtFieldDefinition>
            <BaseFieldName>msg</BaseFieldName>
            <BaseFieldLogText>2349XLG08C - GPU bandwidth issues: Device: 0 DtoH: -1.0 is below threshold: 52.0</BaseFieldLogText>
            <RegexExpression>{test:GPU bandwidth issues}.*?Device:\s*{dev:\d+}\s+DtoH.*threshold:\s*{udff3:[\d\.]+}</RegexExpression>
            <ExtFieldName>dev</ExtFieldName>
            <ExtFieldName>udff3</ExtFieldName>
            <ExtFieldName>test</ExtFieldName>
            <IsSystem>0</IsSystem>
            <IsEnabled>1</IsEnabled>
         </ExtFieldDefinition>
         <ExtFieldDefinition>
            <BaseFieldName>msg</BaseFieldName>
            <BaseFieldLogText>RTTCC disabled check: Failed</BaseFieldLogText>
            <RegexExpression>{test:.*}\s*\:\s*{status:Failed}</RegexExpression>
            <ExtFieldName>status</ExtFieldName>
            <ExtFieldName>test</ExtFieldName>
            <IsSystem>0</IsSystem>
            <IsEnabled>1</IsEnabled>
         </ExtFieldDefinition>
         <ExtFieldDefinition>
            <BaseFieldName>msg</BaseFieldName>
            <BaseFieldLogText>GPU Xid 74 device: 0000:44:00), NVLINK Error</BaseFieldLogText>
            <RegexExpression>GPU\s+Xid\s+{udfi1:\d+}\s+device:\s*{dev:.*}\),\s*{errtext:.*}</RegexExpression>
            <ExtFieldName>dev</ExtFieldName>
            <ExtFieldName>udfi1</ExtFieldName>
            <ExtFieldName>errtext</ExtFieldName>
            <IsSystem>0</IsSystem>
            <IsEnabled>1</IsEnabled>
         </ExtFieldDefinition>
         <ExtFieldDefinition>
            <BaseFieldName>msg</BaseFieldName>
            <BaseFieldLogText>2349XLG08C - GPU bandwidth issues: Device: 0 HtoD: -1.0 is below threshold: 52.0</BaseFieldLogText>
            <RegexExpression>{test:GPU bandwidth issues}.*?Device:\s*{dev:\d+}\s+HtoD.*threshold:\s*{udff2:[\d\.]+}</RegexExpression>
            <ExtFieldName>dev</ExtFieldName>
            <ExtFieldName>udff2</ExtFieldName>
            <ExtFieldName>test</ExtFieldName>
            <IsSystem>0</IsSystem>
            <IsEnabled>1</IsEnabled>
         </ExtFieldDefinition>
      </ExtFieldDefinitions>
      <ExtFieldDefinitions>
         <Condition field="sevlvl" operator="EQUAL">
            <ConditionValues>
               <ConditionValue>INFO</ConditionValue>
            </ConditionValues>
         </Condition>
         <ExtFieldDefinition>
            <BaseFieldName>msg</BaseFieldName>
            <BaseFieldLogText>GPU Remap Test: Passed</BaseFieldLogText>
            <RegexExpression>{test:.*}\s*:\s*{status:.*}</RegexExpression>
            <ExtFieldName>status</ExtFieldName>
            <ExtFieldName>test</ExtFieldName>
            <IsSystem>0</IsSystem>
            <IsEnabled>1</IsEnabled>
         </ExtFieldDefinition>
      </ExtFieldDefinitions>
      <TagConditions>
         <TagCondition alertRuleVisible="0" field="sevlvl" operator="NOT_IN">
            <ConditionValues>
               <ConditionValue>INFO</ConditionValue>
               <ConditionValue>WARNING</ConditionValue>
            </ConditionValues>
            <ConditionTags tagField="mtag">
               <ConditionTag>#check_failed</ConditionTag>
            </ConditionTags>
            <IsSystem>0</IsSystem>
            <IsEnabled>1</IsEnabled>
         </TagCondition>
      </TagConditions>
      <IsHidden>0</IsHidden>
      <IsSMAEnabled>0</IsSMAEnabled>
   </Source>
   <FieldNameMaps>
      <FieldNameMap>
         <Name>udfi1</Name>
         <DisplayName>GPU Xid Error Code</DisplayName>
      </FieldNameMap>
      <FieldNameMap>
         <Name>udfs1</Name>
         <DisplayName>GPU Model</DisplayName>
      </FieldNameMap>
      <FieldNameMap>
         <Name>udff3</Name>
         <DisplayName>BandWidth DtoH</DisplayName>
      </FieldNameMap>
      <FieldNameMap>
         <Name>udff2</Name>
         <DisplayName>BandWidth HtoD</DisplayName>
      </FieldNameMap>
      <FieldNameMap>
         <Name>udfi2</Name>
         <DisplayName>GPU Count</DisplayName>
      </FieldNameMap>
   </FieldNameMaps>
</LoganContent>
